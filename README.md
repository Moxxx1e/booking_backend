# Тестовое задание в юнит Авито.Недвижимость
[![Build Status](https://travis-ci.com/Moxxx1e/booking_backend.svg?token=vgwmUDh1VJziTTk5scPz&branch=main)](https://travis-ci.com/github/Moxxx1e/booking_backend)

## Инструкция по запуску
```
docker-compose up
```

## Юнит-тесты
Тесты запускаются в Travis CI автоматически после каждого пуша. Используется тестовая база данных и фикстуры. Для локального запуска можно использовать команду:
```
make tests
```

## Документация
### Добавить номер отеля - POST /rooms/create
Принимает на вход текстовое описание и цену за ночь. Возвращает ID номера отеля.

Параметры:
* description - текстовое описание
* price - цена за ночь

Пример запроса:

```
curl \
-X POST \
-d "description=Комплекс «Териберка Тур» с \
видом на горы, бесплатным Wi-Fi и бесплатной \
частной парковкой расположен в поселке Териберка, \
в 300 м от песчаного пляжа Териберка." \
-d "price=500" \
http://localhost:9000/rooms/create
```

Пример ответа:

`{"room_id":1}`

### Удалить номер отеля и все его брони - DELETE /rooms/:id
Принимает на вход ID номера отеля, как query-параметр.  Возвращает сообщение об успешном удалении.

Пример запроса:
```
curl \
-X DELETE \
http://localhost:9000/rooms/1
```
Пример ответа:

`{"message":"success"}`

### Получить список номеров отеля - GET /rooms/list
Должна быть возможность отсортировать по цене или по дате добавления (по возрастанию и убыванию).

Принимает на вход параметры сортировки:
* order_by - *created* (по умолчанию) для сортировки по времени добавления, *price* для сортировки по цене;
* desc - *false* (по умолчанию) - для сортировки по возрастанию, *true* - для сортировки по убыванию.

Пример запроса:
```
curl \
-X GET \
"http://localhost:9000/rooms/list?order_by=created&desc=true"
```

Пример ответа:
```
[
    {
        {
            "room_id": 3,
            "description": "Описание комнаты 3",
            "price": 500,
            "created": "2021-01-07T21:40:05.140702Z"
        },
        {   
            "room_id": 2,
            "description": "Описание комнаты 2",
            "price": 500,
            "created": "2021-01-07T21:40:04.319547Z"
        }
    }
]
```

### Добавить бронь - POST /bookings/create
Принимает на вход существующий ID номера отеля, дату начала, дату окончания брони (проверять, свободен ли отель на эти даты, не нужно; даты должны быть в формате `“год-месяц-день”`, например: `“2020-01-30”`; даты должны быть валидными). Возвращает ID брони.

Параметры:
* room_id - id комнаты
* date_start и date_end - даты начала и окончания бронирования


Пример запроса:
```
curl \
-X POST \
-d "room_id=1" \
-d "date_start=2012-12-30" \
-d "date_end=2022-01-02" \
http://localhost:9000/bookings/create
```
Пример ответа:
`
{"booking_id":1}
`

### Удалить бронь - DELETE /rooms/:id
Принимает на вход ID брони, как query-параметр. Возвращает сообщение об успешном удалении.

Пример запроса:
```
curl -X DELETE http://localhost:9000/bookings/1
```

Пример ответа:

```
{"message":"success"}
```

### Получить список броней номера отеля - GET /bookings/list
Принимает на вход ID номера отеля. Возвращает список бронирований, каждое бронирование содержит ID, дату начала, дату окончания. Бронирования должны быть отсортированы по дате начала.

Параметры:
* room_id - id номера

Пример запроса:
```
curl -X \
GET "http://localhost:9000/bookings/list?room_id=1"
```

Пример ответа:
```
[
    {
        "booking_id": 4,
        "date_start": "2012-12-30T00:00:00Z",
        "date_end": "2022-01-02T00:00:00Z",
        "room": 1
    },
    {
        "booking_id": 6,
        "date_start":" 2012-12-30T00:00:00Z",
        "date_end": "2022-01-02T00:00:00Z",
        "room": 1
    }
]
```

## Сомнения по деталям
В условии было написано HTTP JSON API, но примеры подразумевают передачу данных в POST-запросах как x-www-form-urlencoded. Сделал как в примерах.